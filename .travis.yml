language: android
  android:
    licenses:
      - 'android-sdk-preview-license-+'
      - 'android-sdk-license-.+'
      - 'google-gdk-license-.+'

  jdk: oraclejdk8

language: java
  env:
   global:
     - ANDROID_TARGET=android-15
     - ANDROID_ABI=armeabi-v7a
  android:
  script:
   - ./gradlew build jacocoTestReport assembleAndroidTest
   - echo no | android create avd --force -n test -t $ANDROID_TARGET --abi $ANDROID_ABI
   - emulator -avd test -no-skin -no-audio -no-window &
   - android-wait-for-emulator
   - adb shell setprop dalvik.vm.dexopt-flags v=n,o=v
   - ./gradlew connectedCheck
  after_success:
    - bash <(curl -s https://codecov.io/bash)

  os:
    - linux

  # Cache gradle dependencies (should be faster to download them from cache)
  cache:
    directories:
    - $HOME/.gradle/wrapper
    - $HOME/.gradle/caches/modules-2/files-2.1

  # Setup environment
  before_install:
  - yes | sdkmanager "platforms;android-27"
  - chmod +x gradlew